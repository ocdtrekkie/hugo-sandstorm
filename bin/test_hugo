#!/bin/bash

build_only=$1

cd .sandstorm
vagrant destroy -f
cd ..

# this will fail
vagrant-spk vm up

# guest additions seems to require a reboot now...
vagrant-spk vm halt
vagrant-spk vm up

if [[ $build_only == "--build-only" ]]; then
  echo "Building for packing only, no web browser will open!"
  vagrant-spk dev & pid=$!
  # 5 minutes should be enough time...
  sleep 600
  kill -INT $pid
else
  xdg-open http://local.sandstorm.io:6090/
  vagrant-spk dev
fi

echo "If everything went well:"
echo
echo "bin/pack_hugo"
